<!DOCTYPE html>
<html>
<body>

<h2>Compras</h2>

<form name="ConsultaCompra">
            <label>Datos de Proveedores:</label>
            <input type="text" name="proveedoresData"/> <br>
            <label>Datos de la empresa:</label>
            <input type="text" name="empresaData"/> <br>
            <input type="button" value="Calcular Compra" onClick="calcularCompra()"/>
        </form>

<div id="DataEmpresa"> </div>
<div id="dataProveedores"></div>
<div id="diasData"></div>
<div id="precioData"></div>
<div id="comprarData"></div>

<script>

function calcularCompra(){
    limpiar();    
    recibirDatos();
    operaciones();
}

function limpiar(){
    document.getElementById("DataEmpresa").innerHTML="";
    document.getElementById("dataProveedores").innerHTML="";
    document.getElementById("diasData").innerHTML="";
    document.getElementById("precioData").innerHTML="";
    document.getElementById("comprarData").innerHTML="";
}

function recibirDatos(){
    //Recibir Datos
    var proveedor = document.ConsultaCompra.proveedoresData.value;
    var datos = document.ConsultaCompra.empresaData.value;
    //Asignaci贸n
    var obj_pro = JSON.parse(proveedor);
    var obj_data = JSON.parse(datos);
    //Llamar a operaciones
    operaciones(obj_pro, obj_data);
}


function operaciones(obj_pro,obj_data){
    this.obj_pro = obj_pro;
    this.obj_data= obj_data;
    //Asignaci贸n de variables de operaci贸n
    var deseado = obj_data.Qt * obj_data.a * obj_data.dias_cobertura;
    var faltante = deseado - obj_data.actual;
    var dias_holgura = obj_data.actual / obj_data.venta_diaria;

    //Creaci贸n de objeto JSON de salida de operandos
    var consulta = {"deseado":deseado, "faltante":faltante,"dias_holgura":dias_holgura};
    var consultaJSON = JSON.stringify(consulta);
    var obj_consulta = JSON.parse(consultaJSON);

    //Salida de Datos
    document.getElementById("DataEmpresa").innerHTML += "<br>Deseado: "+obj_consulta.deseado +"<br>Faltante: "+faltante +"<br>Actual: "+obj_data.actual+"<br>Venta diaria: "+obj_data.venta_diaria+"<br> Dias Holgura: "+ dias_holgura+"<br><br>"; 

        //Obtencion del precio del producto por dia
    var i=0;
    var price = new Array(obj_pro.length);
    while (obj_pro.id_proveedor[i]!=undefined){
        
        price[i]=obj_pro.precio[i] / obj_pro.dias_surtido[i];
        document.getElementById("dataProveedores").innerHTML +="<div>Id proveedor: "+obj_pro.id_proveedor[i]+" Nombre: "+obj_pro.nombre[i]+" Dias surtido: " +obj_pro.dias_surtido[i]+" Precio "+obj_pro.precio[i]+" Precio por dia "+price[i]+"<br></div>";
       i++; 
    }

    //Dias de Surtido
    i=0;
    var diasIdeal, idealPosition;
    var diaLejano=99, lejanoPosition;
    var diasMinimo=obj_pro.dias_surtido[0], minimoPosition;
    while(obj_pro.dias_surtido[i]!=undefined){
        if (obj_pro.dias_surtido[i]==dias_holgura){
            diasIdeal=obj_pro.dias_surtido[i];
            idealPosition = i;
        }if((obj_pro.dias_surtido[i]<dias_holgura)&&(obj_pro.dias_surtido[i]<diasMinimo)){
            diasMinimo=obj_pro.dias_surtido[i];
            minimoPosition=i;
        }if((obj_pro.dias_surtido[i]>dias_holgura)&&(obj_pro.dias_surtido[i]<diaLejano)){
            diaLejano=obj_pro.dias_surtido[i];
            lejanoPosition=i;
        } 
        i++;
    }
    document.getElementById("diasData").innerHTML += "<div><br>Dias ideal "+diasIdeal+"  Position "+idealPosition+"<br>Dias minimo "+diasMinimo+"  Position "+minimoPosition+"<br>Dias lejano "+diaLejano+"  Position "+lejanoPosition+"</div>";


    //Precio Minimo de surtido
    i=1;
    var minimoPrecio=price[0], preminPosition=0;
    while(price[i]!=undefined){
        if (minimoPrecio>price[i]){
            minimoPrecio=price[i];
            preminPosition = i;
        }
        i++;
    }
    document.getElementById("precioData").innerHTML += "<br>Precio minimo por dia: "+minimoPrecio+"  Position: "+preminPosition;

    //Solicitud
    var precio;
    var unidades;
    var unidadesAntes;
    var unidadesDespues;
    var precioAntes;
    var precioDespues;
    var diasSurte;

    var a = ( (obj_pro.precio[idealPosition]) / (obj_pro.dias_surtido[idealPosition]) );
    var b = ( (obj_pro.precio[minimoPosition]) / (obj_pro.dias_surtido[minimoPosition]) );
    if(idealPosition==preminPosition){
        precio = faltante* obj_pro.precio[idealPosition];
        document.getElementById("comprarData").innerHTML += "<br>Comprar Faltante: "+faltante+" con proveedor "+ obj_pro.nombre[idealPosition] +" a aun costo total: "+ precio; 
    }if ((diasIdeal==dias_holgura)&&(idealPosition!=preminPosition)&&(a<b)){
        diasSurte = obj_pro.dias_surtido[preminPosition] - obj_pro.dias_surtido[idealPosition] ;
        unidadesAntes = diasSurte * obj_data.venta_diaria;
        unidadesDespues = faltante + unidadesAntes;
        precioAntes = unidadesAntes * obj_pro.precio[idealPosition];
        precioDespues = unidadesDespues * obj_pro.precio[preminPosition];
        document.getElementById("comprarData").innerHTML += "<br>El precio mas barato surte con "+diasSurte+" dias despues del ideal<br><br>Por lo tanto comprarar "+unidadesAntes+" unidades a un precio de "+ precioAntes+" al proveedor "+obj_pro.nombre[idealPosition]+" para recibirla despues de "+obj_pro.dias_surtido[idealPosition] +" dias.<br>Y comprar "+unidadesDespues+" unidades a un precio de "+precioDespues+" al proveedor "+obj_pro.nombre[preminPosition]+" para recibirlas despues de " + obj_pro.dias_surtido[preminPosition]  +" dias" ; 

        document.getElementById("comprarData").innerHTML += "<br><br>Precio mayor "+a+" menor que "+b;

    }if ((diasIdeal==dias_holgura)&&(idealPosition!=preminPosition)&&(b<a)){

        document.getElementById("comprarData").innerHTML += "<br><br>Precio "+b+" menor que"+a ;
    }

    if((diaLejano>dias_holgura)&&(idealPosition!=preminPosition)&&(diasMinimo>dias_holgura)){
        document.getElementById("comprarData").innerHTML += "<br>No hay proveedor para satisfacer lo suficientemente rapido; por lo cual le recomiendo con el mas cercano comprar";
        unidades = faltante + (dias_holgura*obj_data.venta_diaria);
        precio = unidades*obj_pro.precio[lejanoPosition];
        document.getElementById("comprarData").innerHTML += "<br>Debera comprar "+unidades+" al proveedor No. "+lejanoPosition+" a un precio total de "+precio ;
    }
}


</script>

</body>
</html>
